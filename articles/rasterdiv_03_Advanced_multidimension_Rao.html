<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multidimension Rao's Index. • rasterdiv</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multidimension Rao's Index.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rasterdiv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/rasterdiv_01_Basics.html">Indices of diversity from NDVI.</a></li>
    <li><a class="dropdown-item" href="../articles/rasterdiv_02_Area_based_Rao.html">Area-based Rao's index.</a></li>
    <li><a class="dropdown-item" href="../articles/rasterdiv_03_Advanced_multidimension_Rao.html">Multidimension Rao's Index.</a></li>
    <li><a class="dropdown-item" href="../articles/rasterdiv_04_Accumulation_Rao.html">Derive the Accumulation Rao's Index</a></li>
    <li><a class="dropdown-item" href="../articles/rasterdiv_05_Helical_Plots.html">Visualising rasterdiv indexes with Helical Plots</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mattmar/rasterdiv/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multidimension Rao's Index.</h1>
            <h3 data-toc-skip class="subtitle">Both for spatial and
spatio-temporal data</h3>
                        <h4 data-toc-skip class="author">Matteo
Marcantonio</h4>
            
            <h4 data-toc-skip class="date">2024-12-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mattmar/rasterdiv/blob/master/vignettes/rasterdiv_03_Advanced_multidimension_Rao.Rmd" class="external-link"><code>vignettes/rasterdiv_03_Advanced_multidimension_Rao.Rmd</code></a></small>
      <div class="d-none name"><code>rasterdiv_03_Advanced_multidimension_Rao.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/gstat/" class="external-link">gstat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mattmar.github.io/rasterdiv/">rasterdiv</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oscarperpinan.github.io/rastervis/" class="external-link">rasterVis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this vignette, we demonstrate how to compute the multidimensional
Rao’s Index using <strong>rasterdiv</strong> for multiple numerical
matrices, represented as spatially autocorrelated <em>SpatRaster</em>
objects.</p>
<div class="section level3">
<h3 id="creating-autocorrelated-spatial-patterns">Creating Autocorrelated Spatial Patterns<a class="anchor" aria-label="anchor" href="#creating-autocorrelated-spatial-patterns"></a>
</h3>
<p>First, we establish a grid that will be used to create spatial
patterns through a semivariogram model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gridDim</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">gridDim</span>, y<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">gridDim</span><span class="op">)</span></span></code></pre></div>
<p>Next, we define a semivariogram and use it to simulate autocorrelated
spatial data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varioMod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/vgm.html" class="external-link">vgm</a></span><span class="op">(</span>psill<span class="op">=</span><span class="fl">0.005</span>, range<span class="op">=</span><span class="fl">100</span>, model<span class="op">=</span><span class="st">'Exp'</span><span class="op">)</span></span>
<span><span class="va">zDummy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/gstat.html" class="external-link">gstat</a></span><span class="op">(</span>formula<span class="op">=</span><span class="va">z</span><span class="op">~</span><span class="fl">1</span>, locations <span class="op">=</span> <span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="va">y</span>, dummy<span class="op">=</span><span class="cn">TRUE</span>, beta<span class="op">=</span><span class="fl">200</span>, model<span class="op">=</span><span class="va">varioMod</span>, nmax<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">xyz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">zDummy</span>, newdata<span class="op">=</span><span class="va">xy</span>, nsim<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>With the simulated data, we then create two SpatRaster objects that
could represent environmental conditions like plant functional
traits.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define coordinate reference system</span></span>
<span><span class="va">utm32N</span> <span class="op">&lt;-</span> <span class="st">"+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span></span>
<span><span class="co"># Create SpatRasters</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">40</span>, ncol<span class="op">=</span><span class="fl">40</span>, crs<span class="op">=</span><span class="va">utm32N</span>, ext<span class="op">=</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10000</span>, <span class="fl">0</span>,<span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="va">r</span></span>
<span><span class="co"># Populate with simulated values</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">xyz</span><span class="op">$</span><span class="va">sim1</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">xyz</span><span class="op">$</span><span class="va">sim2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="computing-multidimensional-raos-index">Computing Multidimensional Rao’s Index<a class="anchor" aria-label="anchor" href="#computing-multidimensional-raos-index"></a>
</h3>
<p>We now calculate the multidimensional Rao’s Index using varying
window sizes and alpha values.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mRao</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/paRao.html">paRao</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">r1</span><span class="op">)</span>, window<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">Inf</span><span class="op">)</span>, na.tolerance<span class="op">=</span><span class="fl">1</span>, method<span class="op">=</span><span class="st">"multidimension"</span>, simplify<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>The output is a nested list of SpatRaster which we can transform in a
stack of SpatRaster and plotted together with the input layers, as
follows:</p>
<div class="section level4">
<h4 id="visualisation-of-the-result">Visualisation of the result<a class="anchor" aria-label="anchor" href="#visualisation-of-the-result"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a list of all the rasters to plot</span></span>
<span><span class="va">rasters_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">r1</span>, <span class="va">mRao</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">alpha.1</span>, <span class="va">mRao</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">alpha.Inf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">rasters_to_plot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Raster1"</span>, <span class="st">"Raster2"</span>, <span class="st">"Rao_Index_Window_3"</span>, <span class="st">"Rao_Index_Window_5"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use lapply to create a list of levelplots</span></span>
<span><span class="va">plots_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">rasters_to_plot</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rst</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/levelplot.html" class="external-link">levelplot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">rst</span>, wide<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, margin<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>  col.regions<span class="op">=</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">magma</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, </span>
<span>  main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>label<span class="op">=</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">rst</span><span class="op">)</span>, </span>
<span>  cex<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Arrange the plots in a grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">gridExtra</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">plots_list</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="rasterdiv_03_Advanced_multidimension_Rao_files/figure-html/unnamed-chunk-8-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="computing-multidimensional-raos-index-for-time-series">Computing Multidimensional Rao’s Index for Time Series<a class="anchor" aria-label="anchor" href="#computing-multidimensional-raos-index-for-time-series"></a>
</h3>
<p>Now, we demonstrate how to compute the multidimensional Rao’s Index
for a time series of rasters accounting for phenology, and compare it
with Rao’s Index on the same time series without a distance metrics that
account for phenology.</p>
</div>
<div class="section level3">
<h3 id="creating-autocorrelated-spatio-temporal-patterns">Creating Autocorrelated Spatio-Temporal Patterns<a class="anchor" aria-label="anchor" href="#creating-autocorrelated-spatio-temporal-patterns"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define variogram model for spatial autocorrelation</span></span>
<span><span class="va">varioMod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/vgm.html" class="external-link">vgm</a></span><span class="op">(</span>psill<span class="op">=</span><span class="fl">2</span>, range<span class="op">=</span><span class="fl">20</span>, model<span class="op">=</span><span class="st">'Exp'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate initial spatially correlated data</span></span>
<span><span class="va">zDummy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/gstat/reference/gstat.html" class="external-link">gstat</a></span><span class="op">(</span>formula<span class="op">=</span><span class="va">z</span><span class="op">~</span><span class="fl">1</span>, locations <span class="op">=</span> <span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="va">y</span>, dummy<span class="op">=</span><span class="cn">TRUE</span>, beta<span class="op">=</span><span class="fl">1</span>, model<span class="op">=</span><span class="va">varioMod</span>, nmax<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">initial_spatial_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">zDummy</span>, newdata<span class="op">=</span><span class="va">xy</span>, nsim<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">initial_spatial_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">initial_spatial_data</span><span class="op">$</span><span class="va">sim1</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">gridDim</span>, ncol<span class="op">=</span><span class="va">gridDim</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate a time series with temporal correlation</span></span>
<span><span class="va">t_steps</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">s_dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gridDim</span>, <span class="va">gridDim</span><span class="op">)</span></span>
<span><span class="va">seasonal_amplitude</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">seasonal_amplitudeR</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">seasonal_frequency</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="va">t_steps</span></span>
<span><span class="va">seasonal_frequencyR</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="va">t_steps</span></span>
<span><span class="va">non_seasonal_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">FALSE</span>, nrow<span class="op">=</span><span class="va">gridDim</span>, ncol<span class="op">=</span><span class="va">gridDim</span><span class="op">)</span></span>
<span><span class="va">non_seasonal_mask</span><span class="op">[</span><span class="fl">15</span><span class="op">:</span><span class="fl">25</span>, <span class="fl">15</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>  <span class="co"># 11 rows centered in the middle</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize the 3D array to store the time series data</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">s_dims</span>, <span class="va">t_steps</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the first time step with the generated spatial data</span></span>
<span><span class="va">initial_spatial_matrix</span><span class="op">[</span><span class="va">non_seasonal_mask</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">initial_spatial_matrix</span><span class="op">[</span><span class="va">non_seasonal_mask</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">initial_spatial_matrix</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_series_data</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">initial_spatial_matrix</span></span></code></pre></div>
<p>The temporally autocorrelated matrices show different seasonality for
a square area at the centre. This area may for example represents a
building or another land cover type with less pronounced seasonal
variation and overall lower index diversity. See the time series plotted
below that visualises the different trends in index values for a subset
of pixels, inside and outside the square area.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate the remaining time steps</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">t_steps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">s_dims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">s_dims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">non_seasonal_mask</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">seasonal_effect</span> <span class="op">&lt;-</span> <span class="va">seasonal_amplitudeR</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">seasonal_frequencyR</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span></span>
<span>        <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>        <span class="va">time_series_data</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span>, <span class="va">t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">seasonal_effect</span> <span class="op">+</span> <span class="va">noise</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">seasonal_effect</span> <span class="op">&lt;-</span> <span class="va">seasonal_amplitude</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">seasonal_frequency</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span></span>
<span>        <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>  <span class="co"># Adding some noise for variability</span></span>
<span>        <span class="va">time_series_data</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span>, <span class="va">t</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">seasonal_effect</span> <span class="op">+</span> <span class="va">noise</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert the 3D array to a SpatRaster for visualization</span></span>
<span><span class="va">raster_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">time_series_data</span>, extent <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, <span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span>, crs<span class="op">=</span><span class="va">utm32N</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the time series for a few specific pixels to illustrate the seasonal pattern</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">t_steps</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">raster_ts</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">raster_ts</span><span class="op">)</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">t_steps</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">'o'</span>, col <span class="op">=</span> <span class="st">'white'</span>, xlab <span class="op">=</span> <span class="st">'Time Step'</span>, ylab <span class="op">=</span> <span class="st">'Value'</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">cl</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">raster_ts</span><span class="op">)</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">rw</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">raster_ts</span><span class="op">)</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pixel_time_series</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="va">rw</span>, <span class="va">cl</span>, <span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">t_steps</span>, <span class="va">pixel_time_series</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span>red <span class="op">=</span> <span class="fl">0</span>, green <span class="op">=</span> <span class="fl">0</span>, blue <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>,ylab<span class="op">=</span><span class="st">"Index value"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="rasterdiv_03_Advanced_multidimension_Rao_files/figure-html/unnamed-chunk-13-1.png" width="95%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set dates for the time series</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-12-31"</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">raster_ts</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="computing-multidimensional-raos-index-with-and-without-phenology">Computing Multidimensional Rao’s Index with and without
phenology<a class="anchor" aria-label="anchor" href="#computing-multidimensional-raos-index-with-and-without-phenology"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate Phenological Rao's Index using TWDTW</span></span>
<span><span class="va">RaoPhen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/paRao.html">paRao</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">raster_ts</span>, </span>
<span>                 window <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                 alpha <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                 na.tolerance <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                 time_vector <span class="op">=</span> <span class="va">dates</span>, </span>
<span>                 method <span class="op">=</span> <span class="st">"multidimension"</span>, </span>
<span>                 dist_m <span class="op">=</span> <span class="st">"twdtw"</span>, </span>
<span>                 np <span class="op">=</span> <span class="fl">7</span>, progBar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate Rao's Index using Euclidean distance</span></span>
<span><span class="va">RaoEuc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/paRao.html">paRao</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">raster_ts</span>, </span>
<span>                window <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                alpha <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                na.tolerance <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                method <span class="op">=</span> <span class="st">"multidimension"</span>, </span>
<span>                dist_m <span class="op">=</span> <span class="st">"euclidean"</span>, </span>
<span>                np <span class="op">=</span> <span class="fl">7</span>, progBar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="visualisation-of-the-result-1">Visualisation of the result<a class="anchor" aria-label="anchor" href="#visualisation-of-the-result-1"></a>
</h4>
<p>The key takeaway is that by accounting for seasonality in our index
time series, we can reduce artifact hotspots in Rao’s index. These
hotspots often arise from transitions between areas with high spatial
variability and those with low spatial variability, which are not due to
plant phenology but to buildings or other human-made objects. This
effect is illustrated by the square area in the centre of the plot
below.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualization</span></span>
<span><span class="va">raster_ts_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/levelplot.html" class="external-link">levelplot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">raster_ts</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                            col.regions <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, </span>
<span>                            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Average index"</span>, </span>
<span>                            cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">RaoP_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/levelplot.html" class="external-link">levelplot</a></span><span class="op">(</span><span class="va">RaoPhen</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, margin <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                       col.regions <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, </span>
<span>                       main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Phenological Rao"</span>, </span>
<span>                       cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Rao_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/levelplot.html" class="external-link">levelplot</a></span><span class="op">(</span><span class="va">RaoEuc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, margin <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                      col.regions <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, </span>
<span>                      main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Rao"</span>, </span>
<span>                      cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">gridExtra</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">raster_ts_plot</span>, <span class="va">Rao_plot</span>, <span class="va">RaoP_plot</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PhenoRao.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matteo Marcantonio, Martina Iannacito, Elisa Thouverai, Michele Torresani, Daniele Da Re, Clara Tattoni, Giovanni Bacaro, Saverio Vicario, Carlo Ricotta, Duccio Rocchini.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
