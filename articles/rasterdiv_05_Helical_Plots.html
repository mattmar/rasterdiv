<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rasterdiv">
<title>Visualising rasterdiv indexes with Helical Plots • rasterdiv</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Visualising rasterdiv indexes with Helical Plots">
<meta property="og:description" content="rasterdiv">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rasterdiv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/rasterdiv_01_Basics.html">Indices of diversity from NDVI.</a>
    <a class="dropdown-item" href="../articles/rasterdiv_02_Area_based_Rao.html">Area-based Rao's index.</a>
    <a class="dropdown-item" href="../articles/rasterdiv_03_Advanced_multidimension_Rao.html">Multidimension Rao's Index.</a>
    <a class="dropdown-item" href="../articles/rasterdiv_04_Accumulation_Rao.html">Derive the Accumulation Rao's Index</a>
    <a class="dropdown-item" href="../articles/rasterdiv_05_Helical_Plots.html">Visualising rasterdiv indexes with Helical Plots</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mattmar/rasterdiv/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Visualising rasterdiv indexes with Helical Plots</h1>
                        <h4 data-toc-skip class="author">Matteo
Marcantonio, Elisa Thouverai, Duccio Rocchini</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mattmar/rasterdiv/blob/HEAD/vignettes/rasterdiv_05_Helical_Plots.Rmd" class="external-link"><code>vignettes/rasterdiv_05_Helical_Plots.Rmd</code></a></small>
      <div class="d-none name"><code>rasterdiv_05_Helical_Plots.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://mattmar.github.io/rasterdiv/">rasterdiv</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://covid19datahub.io" class="external-link">COVID19</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette demonstrates the application of
<strong>rasterdiv</strong> for visualising time-series data, such as
Rao’s index, using <code>helical plots</code>. The concept of
<code>helical graphs</code> was introduced by Danny Dorling and Kirsten
McClur as an alternative way to visualise the progression and rate of
change in a time series. This approach can be particularly useful to
look at time series of disease case progression during pandemic events,
such as during COVID-19. Here, we adapt this method for time series of
ecological indexes like Rao’s Quadratic Entropy.</p>
<div class="section level3">
<h3 id="ndvi-time-series-of-a-deciduous-forest">NDVI Time Series of a Deciduous Forest<a class="anchor" aria-label="anchor" href="#ndvi-time-series-of-a-deciduous-forest"></a>
</h3>
<p>ndviForestTS is a list of 3x3 matrix simulating (following a
sinusoidal function with some Gaussian noise) the NDVI values (8-bit) of
a patch of deciduous forest in a temperate climate from 1st of January
for 3 years.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load NDVI time series data</span></span>
<span><span class="va">ndviForestTS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ndviForestTS.rds"</span>, package <span class="op">=</span> <span class="st">"rasterdiv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the average NDVI for the forest patch</span></span>
<span><span class="va">avgNDVI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ndviForestTS</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the average NDVI over time</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-01-01"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ndviForestTS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dates</span>, <span class="va">avgNDVI</span>, type <span class="op">=</span> <span class="st">'l'</span>, col <span class="op">=</span> <span class="st">'darkgreen'</span>, xlab <span class="op">=</span> <span class="st">'Day of Year'</span>, ylab <span class="op">=</span> <span class="st">'NDVI'</span>, main <span class="op">=</span> <span class="st">'Seasonal NDVI Variation'</span><span class="op">)</span></span></code></pre></div>
<p><img src="rasterdiv_05_Helical_Plots_files/figure-html/unnamed-chunk-2-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="raos-index-calculation">Rao’s Index Calculation<a class="anchor" aria-label="anchor" href="#raos-index-calculation"></a>
</h3>
<p>We calculate Rao’s Index using three different alpha values (1, 5,
and 10) for just one of the three years.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate Rao's Index for alpha values 1, 5, and 10</span></span>
<span><span class="va">RaoT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ndviForestTS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    a1 <span class="op">=</span> <span class="fu"><a href="../reference/paRao.html">paRao</a></span><span class="op">(</span><span class="va">x</span>, window <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">1</span>, na.tolerance <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>    a5 <span class="op">=</span> <span class="fu"><a href="../reference/paRao.html">paRao</a></span><span class="op">(</span><span class="va">x</span>, window <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">5</span>, na.tolerance <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>    a10 <span class="op">=</span> <span class="fu"><a href="../reference/paRao.html">paRao</a></span><span class="op">(</span><span class="va">x</span>, window <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">10</span>, na.tolerance <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract integer values for each alpha</span></span>
<span><span class="va">RaoT.C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">RaoT</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="va">y</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">RaoT.C</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rao's with alpha = 1"</span>, <span class="st">"Rao's Alpha = 5"</span>, <span class="st">"Rao's Alpha = 10"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-preparation-for-helical-plotting">Data Preparation for Helical Plotting<a class="anchor" aria-label="anchor" href="#data-preparation-for-helical-plotting"></a>
</h3>
<p>The <code>heliPrep</code> function is designed to process time series
data for visualization using the <code>heliPlot</code> function. It
applies a moving average filter to smooth the data, enhancing the
helical plot’s visual appeal by producing more pronounced curves. The
<code>filterWidth</code> parameter allows for the customisation of the
moving window’s breadth, which considers both preceding and subsequent
values in its calculations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare data for helical plotting</span></span>
<span><span class="va">dataPrepRao</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">RaoT.C</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/heliPrep.html">heliPrep</a></span><span class="op">(</span><span class="va">dates</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">]</span>, <span class="va">RaoT.C</span><span class="op">[</span>,<span class="va">alpha</span><span class="op">]</span>, filterWidth<span class="op">=</span><span class="fl">90</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">alpha</span></span>
<span>  <span class="va">df</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="helical-plots-visualisation">Helical Plots Visualisation<a class="anchor" aria-label="anchor" href="#helical-plots-visualisation"></a>
</h3>
<p>With the data now appropriately smoothed, <code>heliPlot</code> can
generate the helical plots. This function incorporates
<code><a href="https://ggforce.data-imaginist.com/reference/geom_bspline.html" class="external-link">ggforce::geom_bspline()</a></code> to further refine the smoothness of
the time series representation. The <code>n</code> parameter controls
the granularity of the B-spline curve, representing the total number of
points used in the interpolation process. It’s crucial that
<code>n</code> is set higher than the actual number of points to be
interpolated to ensure a smooth curve without any graphical
artefacts.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create helical plots for each alpha</span></span>
<span><span class="fu"><a href="../reference/heliPlot.html">heliPlot</a></span><span class="op">(</span><span class="va">dataPrepRao</span>, facet <span class="op">=</span> <span class="cn">TRUE</span>, group <span class="op">=</span> <span class="st">"alpha"</span>, arrow <span class="op">=</span> <span class="cn">FALSE</span>, labelInterval <span class="op">=</span> <span class="fl">180</span>, sizeRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">2</span><span class="op">)</span>, facetScales <span class="op">=</span> <span class="st">"free_x"</span>, n<span class="op">=</span><span class="fl">2000</span><span class="op">)</span></span></code></pre></div>
<p><img src="rasterdiv_05_Helical_Plots_files/figure-html/unnamed-chunk-5-1.png" width="95%" style="display: block; margin: auto;"></p>
<p>Moreover, the NDVI time series can be effectively visualised using
helical plots. To accentuate the spiralling trends, which may arise from
daily fluctuations in water content or artefacts in spectral data
retrieval, we partition the year into two distinct sections. This
approach allows us to closely observe and differentiate the subtle
shifts within each phase of the annual vegetative cycle.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare NDVI data</span></span>
<span><span class="va">dataPrepNDVI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/heliPrep.html">heliPrep</a></span><span class="op">(</span><span class="va">dates</span>, <span class="va">avgNDVI</span>, filterWidth<span class="op">=</span><span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create helical plot for NDVI till the spring months</span></span>
<span><span class="fu"><a href="../reference/heliPlot.html">heliPlot</a></span><span class="op">(</span><span class="va">dataPrepNDVI</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">250</span>,<span class="op">]</span>, arrow <span class="op">=</span> <span class="cn">TRUE</span>, labelInterval <span class="op">=</span> <span class="fl">30</span>, sizeRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">2</span><span class="op">)</span>,n<span class="op">=</span><span class="fl">10000</span>, ylab<span class="op">=</span><span class="st">"Average NDVI 8-bit values"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rasterdiv_05_Helical_Plots_files/figure-html/unnamed-chunk-6-1.png" width="95%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create helical plot for NDVI for the winter months</span></span>
<span><span class="fu"><a href="../reference/heliPlot.html">heliPlot</a></span><span class="op">(</span><span class="va">dataPrepNDVI</span><span class="op">[</span><span class="fl">251</span><span class="op">:</span><span class="fl">365</span>,<span class="op">]</span>, arrow <span class="op">=</span> <span class="cn">TRUE</span>, labelInterval <span class="op">=</span> <span class="fl">30</span>, sizeRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">2</span><span class="op">)</span>,n<span class="op">=</span><span class="fl">10000</span>, ylab<span class="op">=</span><span class="st">"Average NDVI 8-bit values"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rasterdiv_05_Helical_Plots_files/figure-html/unnamed-chunk-6-2.png" width="95%" style="display: block; margin: auto;"></p>
<p>These plots depict the seasonal cycle of NDVI values for a
broadleaved forest patch. The values rise in spring, culminate in a peak
in July (first figure), and plateau during the final summer months
before diminishing from early autumn in response to leaf senescence
(second figure). The x-axis demonstrates that the rate of change in NDVI
is comparably stable during both the growth and decline phases. This
consistency is anticipated since the values were simulated using a
monotonous sinusoidal function with an overlay of Gaussian noise.</p>
</div>
<div class="section level2">
<h2 id="applying-helical-plots-to-covid-19-data">Applying helical plots to COVID-19 data<a class="anchor" aria-label="anchor" href="#applying-helical-plots-to-covid-19-data"></a>
</h2>
<p>On a final note, we can visualise the trend of deaths caused by
COVID-19 in the first months of the recent pandemic, by using helical
plots. This method was initially used to represent the dynamics of
COVID-19 case numbers and can provide insights into the progression of
the pandemic over time. To begin, we must acquire the relevant COVID-19
data. Our analysis will centre on a select group of countries, with a
particular emphasis on the daily confirmed cases and fatalities.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download data for selected countries up to a specified date.</span></span>
<span><span class="va">covidCases</span> <span class="op">&lt;-</span> <span class="fu">COVID19</span><span class="fu">::</span><span class="fu"><a href="https://covid19datahub.io/reference/covid19.html" class="external-link">covid19</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Italy"</span>, <span class="st">"US"</span>, <span class="st">"Belgium"</span>, <span class="st">"Germany"</span>,<span class="st">"France"</span><span class="op">)</span>, </span>
<span>  level <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  end <span class="op">=</span> <span class="st">"2020-04-05"</span></span>
<span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"confirmed"</span>, <span class="st">"deaths"</span>, <span class="st">"population"</span>, <span class="st">"administrative_area_level_1"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># Calculate daily metrics.</span></span>
<span><span class="va">covidCases.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">covidCases</span><span class="op">$</span><span class="va">administrative_area_level_1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">covidCases</span><span class="op">[</span><span class="va">covidCases</span><span class="op">$</span><span class="va">administrative_area_level_1</span><span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span><span class="va">x</span>,<span class="op">]</span></span>
<span>  <span class="va">temp</span><span class="op">$</span><span class="va">dailyCases</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">confirmed</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">confirmed</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">temp</span><span class="op">$</span><span class="va">dailyDeaths</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">deaths</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">deaths</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove NA's</span></span>
<span><span class="va">covidCases.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/na.omit.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">covidCases.df</span><span class="op">)</span></span></code></pre></div>
<p>We will use the <strong>heliPrep</strong> function to prepare the
data for plotting. This involves smoothing the daily death counts to
visualise the rate of change over time.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare data for each administrative area.</span></span>
<span><span class="va">covidPrep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">covidCases.df</span><span class="op">$</span><span class="va">administrative_area_level_1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">covidCases.df</span><span class="op">[</span><span class="va">covidCases.df</span><span class="op">$</span><span class="va">administrative_area_level_1</span><span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span><span class="va">x</span>,<span class="op">]</span></span>
<span>  <span class="va">outPrep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/heliPrep.html">heliPrep</a></span><span class="op">(</span>dates<span class="op">=</span><span class="va">temp</span><span class="op">$</span><span class="va">date</span>, values<span class="op">=</span><span class="va">temp</span><span class="op">$</span><span class="va">dailyDeaths</span>, filterWidth<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">outPrep</span><span class="op">$</span><span class="va">country</span><span class="op">=</span><span class="va">x</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">outPrep</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">covidPrep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>,<span class="va">covidPrep</span><span class="op">)</span></span></code></pre></div>
<p>We now create helical plots for either a single country or for
multiple countries for comparison.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot for Italy.</span></span>
<span><span class="fu"><a href="../reference/heliPlot.html">heliPlot</a></span><span class="op">(</span><span class="va">covidPrep</span><span class="op">[</span><span class="va">covidPrep</span><span class="op">$</span><span class="va">country</span><span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span><span class="st">"Italy"</span>,<span class="op">]</span>, arrow <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  labelInterval <span class="op">=</span> <span class="fl">365</span>, n<span class="op">=</span><span class="fl">5000</span>, sizeRange<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="rasterdiv_05_Helical_Plots_files/figure-html/unnamed-chunk-9-1.png" width="95%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/heliPlot.html">heliPlot</a></span><span class="op">(</span><span class="va">covidPrep</span>, arrow <span class="op">=</span> <span class="cn">FALSE</span>, facet<span class="op">=</span><span class="cn">FALSE</span>, gr<span class="op">=</span><span class="st">"country"</span>, </span>
<span>  labelInterval <span class="op">=</span> <span class="fl">365</span>, sizeRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">4</span><span class="op">)</span>, n<span class="op">=</span><span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<p><img src="rasterdiv_05_Helical_Plots_files/figure-html/unnamed-chunk-9-2.png" width="95%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="customising-heliplot">Customising heliPlot<a class="anchor" aria-label="anchor" href="#customising-heliplot"></a>
</h3>
<p>heliPlot can be customised with ggplot2 functions to match specific
styles or references. For example, to mimic the visualizations from <a href="https://theconversation.com/three-graphs-that-show-a-global-slowdown-in-covid-19-deaths-135756" class="external-link">The
Conversation’s article on COVID-19</a>, we can adjust the plot as
follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/heliPlot.html">heliPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">covidPrep</span>,</span>
<span>  arrow <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  facet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  gr <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>  labelInterval <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  sizeRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">50000</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Average Number of Deaths per Day"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Increase or Decrease in Deaths per Day"</span>,</span>
<span>  angle<span class="op">=</span> <span class="fl">45</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">250</span>, <span class="fl">300</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1400</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#ad363e"</span>, <span class="st">"#01a0e3"</span>, <span class="st">"#6c5575"</span>, <span class="st">"#f27e32"</span>, <span class="st">"#1f437d"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    aspect.ratio <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.15</span><span class="op">)</span>,</span>
<span>    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Mortality in five countries attributed to COVID-19 (January 23 to April 5, 2020)."</span><span class="op">)</span></span></code></pre></div>
<p><img src="rasterdiv_05_Helical_Plots_files/figure-html/unnamed-chunk-10-1.png" width="95%" style="display: block; margin: auto;"></p>
<p>The customisation of <strong>HeliPlot</strong> provided above
includes manual colour scales, legend adjustments, and panel border
styling as a attempt to replicate the (simplified) appearance from The
Conversation’s article on COVID-19.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matteo Marcantonio, Martina Iannacito, Elisa Thouverai, Michele Torresani, Daniele Da Re, Clara Tattoni, Giovanni Bacaro, Saverio Vicario, Carlo Ricotta, Duccio Rocchini.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
